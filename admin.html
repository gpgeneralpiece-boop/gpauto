<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GP AUTO - Panel Administration</title>
    <link rel="stylesheet" href="styles/admin.css">
    <link rel="icon" href="imgs/logo.png" type="image/png">
</head>
<body>
    <!-- Header Admin -->
    <header class="admin-header">
        <div class="admin-logo">
            <img src="imgs/logo.png" alt="GP AUTO Logo">
            <h1>GP AUTO - Administration</h1>
        </div>
        <div class="admin-user">
            <span class="user-status">
                <span class="status-indicator online"></span>
                Admin connect√©
            </span>
            <button class="btn btn-secondary" onclick="logout()">D√©connexion</button>
        </div>
    </header>

    <!-- Navigation Admin -->
    <nav class="admin-nav">
        <button class="nav-btn active" data-tab="dashboard" onclick="switchTab('dashboard')">
            <svg class="nav-icon"><!-- Dashboard Icon --></svg>
            Tableau de Bord
        </button>
        <button class="nav-btn" data-tab="vehicles" onclick="switchTab('vehicles')">
            <svg class="nav-icon"><!-- Vehicle Icon --></svg>
            V√©hicules
        </button>
        <button class="nav-btn" data-tab="parts" onclick="switchTab('parts')">
            <svg class="nav-icon"><!-- Parts Icon --></svg>
            Pi√®ces
        </button>
        <button class="nav-btn" data-tab="orders" onclick="switchTab('orders')">
            <svg class="nav-icon"><!-- Orders Icon --></svg>
            Commandes
        </button>
        <button class="nav-btn" data-tab="settings" onclick="switchTab('settings')">
            <svg class="nav-icon"><!-- Settings Icon --></svg>
            Configuration
        </button>
    </nav>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Dashboard -->
        <section id="dashboard" class="tab-content active">
            <div class="tab-header">
                <h2>Tableau de Bord</h2>
                <button class="btn btn-primary" onclick="refreshStats()">üîÑ Actualiser</button>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üöó</div>
                    <div class="stat-info">
                        <h3 id="totalVehicles">-</h3>
                        <p>V√©hicules en base</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üîß</div>
                    <div class="stat-info">
                        <h3 id="totalParts">-</h3>
                        <p>Pi√®ces au catalogue</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üõí</div>
                    <div class="stat-info">
                        <h3 id="totalOrders">-</h3>
                        <p>Commandes re√ßues</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-info">
                        <h3 id="totalRevenue">-</h3>
                        <p>Chiffre d'affaires</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Actions Rapides</h3>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="addVehicle()">‚ûï Ajouter V√©hicule</button>
                    <button class="btn btn-success" onclick="addPart()">‚ûï Ajouter Pi√®ce</button>
                    <button class="btn btn-info" onclick="viewAllOrders()">üëÅÔ∏è Voir Commandes</button>
                    <button class="btn btn-secondary" onclick="exportData()">üìä Exporter Donn√©es</button>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="recent-section">
                <h3>Commandes R√©centes</h3>
                <div id="recentOrders" class="recent-list">
                    <div class="loading">Chargement des commandes...</div>
                </div>
            </div>
        </section>

        <!-- V√©hicules -->
        <section id="vehicles" class="tab-content">
            <div class="tab-header">
                <h2>Gestion des V√©hicules</h2>
                <button class="btn btn-primary" onclick="addVehicle()">‚ûï Nouveau V√©hicule</button>
            </div>

            <!-- Search and Filters -->
            <div class="search-filters">
                <input type="text" id="vehicleSearch" placeholder="Rechercher par marque ou mod√®le..." onkeyup="filterVehicles()">
                <select id="brandFilter" onchange="filterVehicles()">
                    <option value="">Toutes les marques</option>
                </select>
            </div>

            <!-- Vehicles Table -->
            <div class="data-table">
                <table id="vehiclesTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Marque</th>
                            <th>Mod√®le</th>
                            <th>Ann√©e</th>
                            <th>Motorisations</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vehiclesTableBody">
                        <tr><td colspan="7" class="loading">Chargement...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Pi√®ces -->
        <section id="parts" class="tab-content">
            <div class="tab-header">
                <h2>Gestion des Pi√®ces</h2>
                <button class="btn btn-primary" onclick="addPart()">‚ûï Nouvelle Pi√®ce</button>
            </div>

            <!-- Search and Filters -->
            <div class="search-filters">
                <input type="text" id="partSearch" placeholder="Rechercher par nom, SKU ou r√©f√©rence OE..." onkeyup="filterParts()">
                <select id="categoryFilter" onchange="filterParts()">
                    <option value="">Toutes les cat√©gories</option>
                </select>
                <select id="stockFilter" onchange="filterParts()">
                    <option value="">Tous les stocks</option>
                    <option value="in-stock">En stock</option>
                    <option value="low-stock">Stock faible</option>
                    <option value="out-of-stock">Rupture</option>
                </select>
            </div>

            <!-- Parts Table -->
            <div class="data-table">
                <table id="partsTable">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>SKU</th>
                            <th>Nom</th>
                            <th>Cat√©gorie</th>
                            <th>Prix (TND)</th>
                            <th>Stock</th>
                            <th>Marque</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="partsTableBody">
                        <tr><td colspan="8" class="loading">Chargement...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Commandes -->
        <section id="orders" class="tab-content">
            <div class="tab-header">
                <h2>Gestion des Commandes</h2>
                <button class="btn btn-secondary" onclick="exportOrders()">üìÑ Exporter</button>
            </div>

            <!-- Orders Filters -->
            <div class="search-filters">
                <select id="statusFilter" onchange="filterOrders()">
                    <option value="">Tous les statuts</option>
                    <option value="pending">En attente</option>
                    <option value="processing">En traitement</option>
                    <option value="shipped">Exp√©di√©</option>
                    <option value="delivered">Livr√©</option>
                    <option value="cancelled">Annul√©</option>
                </select>
                <input type="date" id="dateFilter" onchange="filterOrders()">
            </div>

            <!-- Orders Table -->
            <div class="data-table">
                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th>Commande #</th>
                            <th>Client</th>
                            <th>T√©l√©phone</th>
                            <th>Date</th>
                            <th>Total (TND)</th>
                            <th>Livraison</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <tr><td colspan="8" class="loading">Chargement...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Configuration -->
        <section id="settings" class="tab-content">
            <div class="tab-header">
                <h2>Configuration</h2>
            </div>

            <div class="settings-grid">
                <!-- Livraison -->
                <div class="settings-card">
                    <h3>Configuration Livraison</h3>
                    <div class="form-group">
                        <label>Seuil livraison gratuite (TND)</label>
                        <input type="number" id="freeDeliveryThreshold" value="200" min="0">
                    </div>
                    <div class="form-group">
                        <label>Frais de livraison (TND)</label>
                        <input type="number" id="deliveryFee" value="5" min="0">
                    </div>
                    <button class="btn btn-primary" onclick="saveDeliverySettings()">üíæ Sauvegarder</button>
                </div>

                <!-- Site -->
                <div class="settings-card">
                    <h3>Configuration Site</h3>
                    <div class="form-group">
                        <label>Nom du site</label>
                        <input type="text" id="siteName" value="GP AUTO - G√©n√©ral Pi√®ces Autos">
                    </div>
                    <div class="form-group">
                        <label>T√©l√©phone</label>
                        <input type="text" id="sitePhone" value="+216 XX XXX XXX">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="siteEmail" value="contact@gp-auto.tn">
                    </div>
                    <button class="btn btn-primary" onclick="saveSiteSettings()">üíæ Sauvegarder</button>
                </div>

                <!-- Maintenance -->
                <div class="settings-card">
                    <h3>Maintenance</h3>
                    <div class="form-group">
                        <label>Mode maintenance</label>
                        <div class="toggle-switch">
                            <input type="checkbox" id="maintenanceMode">
                            <span class="slider"></span>
                        </div>
                    </div>
                    <button class="btn btn-warning" onclick="clearCache()">üóëÔ∏è Vider le cache</button>
                    <button class="btn btn-danger" onclick="resetDatabase()">üîÑ R√©initialiser BD</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal pour V√©hicules -->
    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="vehicleModalTitle">Nouveau V√©hicule</h3>
                <span class="close" onclick="closeModal('vehicleModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="vehicleForm">
                    <input type="hidden" id="vehicleId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Marque *</label>
                            <div class="input-group">
                                <select id="vehicleBrand" onchange="loadModelsForBrand()">
                                    <option value="">S√©lectionner ou cr√©er</option>
                                </select>
                                <input type="text" id="vehicleBrandNew" placeholder="Nouvelle marque" style="display: none;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Mod√®le *</label>
                            <div class="input-group">
                                <select id="vehicleModel" onchange="loadEnginesForVehicle()">
                                    <option value="">S√©lectionner ou cr√©er</option>
                                </select>
                                <input type="text" id="vehicleModelNew" placeholder="Nouveau mod√®le" style="display: none;">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ann√©e de d√©but</label>
                            <input type="number" id="vehicleYearFrom" min="1980" max="2030">
                        </div>
                        <div class="form-group">
                            <label>Ann√©e de fin</label>
                            <input type="number" id="vehicleYearTo" min="1980" max="2030">
                        </div>
                    </div>
                    
                    <!-- Motorisations multiples -->
                    <div class="form-group">
                        <label>Motorisations *</label>
                        <div id="enginesContainer">
                            <!-- Les motorisations seront ajout√©es ici -->
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addEngineField()" style="margin-top: 10px;">
                            ‚ûï Ajouter une motorisation
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('vehicleModal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveVehicle()">üíæ Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Modal pour Pi√®ces -->
    <div id="partModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="partModalTitle">Nouvelle Pi√®ce</h3>
                <span class="close" onclick="closeModal('partModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="partForm">
                    <input type="hidden" id="partId">
                    <div class="form-group">
                        <label>Nom de la pi√®ce *</label>
                        <input type="text" id="partName" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>SKU (R√©f√©rence article) *</label>
                            <input type="text" id="partSku" required>
                        </div>
                        <div class="form-group">
                            <label>Cat√©gorie *</label>
                            <select id="partCategory" required>
                                <option value="">S√©lectionner</option>
                                <option value="Freinage">Freinage</option>
                                <option value="Filtration">Filtration</option>
                                <option value="Allumage">Allumage</option>
                                <option value="Suspension">Suspension</option>
                                <option value="√âlectrique">√âlectrique</option>
                                <option value="Carrosserie">Carrosserie</option>
                                <option value="Pneumatiques">Pneumatiques</option>
                                <option value="Moteur">Moteur</option>
                                <option value="Transmission">Transmission</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Prix (TND) *</label>
                            <input type="number" id="partPrice" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Stock *</label>
                            <input type="number" id="partStock" min="0" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Marque</label>
                            <input type="text" id="partBrand">
                        </div>
                        <div class="form-group">
                            <label>URL Image</label>
                            <input type="url" id="partImageUrl">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="partDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>R√©f√©rences OE (s√©par√©es par des virgules)</label>
                        <input type="text" id="partOeReferences" placeholder="ex: 1234567890,0987654321">
                    </div>
                    
                    <!-- Section v√©hicules compatibles -->
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="showVehicleSelector" onchange="toggleVehicleSelector()">
                            V√©hicules compatibles
                        </label>
                        <div id="vehicleSelectorContainer" style="display: none; margin-top: 10px;">
                            <div class="compatible-vehicles">
                                <div id="vehicleList" class="vehicle-selector">
                                    <!-- Liste des v√©hicules charg√©e dynamiquement -->
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('partModal')">Annuler</button>
                <button class="btn btn-primary" onclick="savePart()">üíæ Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Modal pour Commande -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>D√©tails de la Commande #<span id="orderModalId"></span></h3>
                <span class="close" onclick="closeModal('orderModal')">&times;</span>
            </div>
            <div class="modal-body" id="orderDetails">
                <!-- D√©tails de la commande charg√©s dynamiquement -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('orderModal')">Fermer</button>
                <button class="btn btn-success" onclick="updateOrderStatus('processing')">En traitement</button>
                <button class="btn btn-info" onclick="updateOrderStatus('shipped')">Exp√©di√©</button>
                <button class="btn btn-success" onclick="updateOrderStatus('delivered')">Livr√©</button>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast" class="toast">
        <div class="toast-content">
            <span id="toastMessage">Message de notification</span>
            <button class="toast-close" onclick="hideToast()">&times;</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="scripts/admin.js"></script>
</body>
</html>